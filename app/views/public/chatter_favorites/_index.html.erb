<% if chatter_favorites.blank? %>
  <p class="m-3 alert alert-dark">お気に入りはありません</p>
<% else %>
  <% chatter_favorites.each do |favorite| %>
    <div class="py-2 px-4">
      <%# ↓リポストを取得しない投稿一覧ページ（お気に入り一覧など）でも
      同じ部分テンプレートを利用しているため、この判定を入れている %>
      <% if favorite.chatter.has_attribute?(:rechatter_user_id) %>
        <% if favorite.chatter.rechatter_user_id.present? %>
          <div class="row ml-1 mb-1">
            <span class="text-muted d-inline-block text-truncate">
              <i class="fa-solid fa-bullhorn text-info"></i>
              Rechattered by
              <%= link_to favorite.chatter.rechatter_user_name, user_path(favorite.chatter.rechatter_user_id), class: "text-muted" %>
            </span>
          </div>
        <% end %>
      <% end %>
      <% if favorite.chatter.replying.exists? %>
        <div class="row ml-1 mb-1">
          <span class="d-inline-block text-truncate text-muted">
            <%= link_to chatter_path(favorite.chatter.replied_chatter(chatter)), class: "text-muted" do %>
              <i class="fa-solid fa-reply text-muted"></i>
              <span class="text-muted">
                Reply to <%= favorite.chatter.replied_chatter(favorite.chatter).user.name %>
              </span>
            <% end %>
          </span>
        </div>
      <% end %>
      <div class="row">
        <div class="col-2 mx-auto">
          <%= link_to user_path(favorite.chatter_user) do %>
            <%= image_tag favorite.chatter_user.get_profile_image(50, 50), class: "rounded m-1" %>
          <% end %>
          <% if favorite.chatter_user == current_user %>
          <div>
            <%= link_to chatter_path(favorite.chatter), method: :delete, remote: true, class: "btn btn-sm btn-danger m-1", data: { confirm: "削除しますか？" } do %>
              <i class="fa-solid fa-trash-can"></i>
            <% end %>
          </div>
          <% end %>
        </div>
        <div class="col-9">
          <p class="d-flex justify-content-between">
            <%= link_to favorite.chatter_user.name, user_path(favorite.chatter_user), class: "text-light text-truncate mr-1 font-weight-bold" %>
            <%= render 'public/users/lock', user: favorite.chatter_user %>
            <span class="text-nowrap text-muted">
              <%= favorite.chatter.created_at.strftime('%Y/%m/%d %H:%M') %>
            </span>
          </p>
          <% unless favorite.chatter_user.is_public == true || current_user.following?(favorite.chatter_user) || favorite.chatter_user == current_user %>
            <p class="alert alert-dark">非公開ユーザーによる投稿です。<br>
            閲覧するには投稿ユーザーをフォローしてください。</p>
          <% else %>
            <p class="text-break"><%= raw Rinku.auto_link(h(safe_join(favorite.chatter.body.split("\n"),tag(:br)))) %></p>
            <div class="d-flex justify-content-around">
              <div class="text-muted mr-1" style="cursor: pointer;" data-toggle="modal" data-target="#reply-modal_<%= favorite.chatter.id %>">
                <i class="fa-solid fa-reply"></i><%= favorite.chatter.reply_to_chatters_count %>
              </div>
              <div class="rechatter-btn_<%= favorite.chatter.id %> mr-1">
                <%= render 'public/rechatters/rechatter-btn', chatter: favorite.chatter %>
              </div>
              <div class="chatter-favorite-btn_<%= favorite.chatter.id %>">
                <%= render 'public/chatter_favorites/favorite-btn', chatter: favorite.chatter %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <hr color="#6c757d">
    </div>

      <!--reply modal-->
      <%= render 'public/replies/modal', reply_to: favorite.chatter %>

  <% end %>
<% end %>